{"filter":false,"title":"index.js","tooltip":"/index.js","undoManager":{"mark":100,"position":100,"stack":[[{"group":"doc","deltas":[{"start":{"row":4,"column":27},"end":{"row":4,"column":28},"action":"insert","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":28},"end":{"row":4,"column":29},"action":"insert","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":29},"end":{"row":4,"column":30},"action":"insert","lines":[")"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":30},"end":{"row":4,"column":31},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":31},"end":{"row":4,"column":32},"action":"insert","lines":["{"]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":32},"end":{"row":5,"column":0},"action":"insert","lines":["",""]},{"start":{"row":5,"column":0},"end":{"row":5,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":2},"end":{"row":6,"column":0},"action":"insert","lines":["",""]},{"start":{"row":6,"column":0},"end":{"row":6,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":2},"end":{"row":7,"column":0},"action":"insert","lines":["",""]},{"start":{"row":7,"column":0},"end":{"row":7,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":0},"end":{"row":7,"column":2},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":0},"end":{"row":7,"column":1},"action":"insert","lines":["}"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":1},"end":{"row":5,"column":2},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":2},"end":{"row":5,"column":3},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":3},"end":{"row":5,"column":4},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":4},"end":{"row":5,"column":5},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":5},"end":{"row":5,"column":6},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":6},"end":{"row":5,"column":7},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":7},"end":{"row":5,"column":8},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":8},"end":{"row":5,"column":9},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":9},"end":{"row":5,"column":10},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":10},"end":{"row":5,"column":11},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":11},"end":{"row":5,"column":12},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":12},"end":{"row":5,"column":13},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":13},"end":{"row":5,"column":14},"action":"insert","lines":["x"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":14},"end":{"row":5,"column":15},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":15},"end":{"row":5,"column":16},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":16},"end":{"row":5,"column":17},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":17},"end":{"row":5,"column":18},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":18},"end":{"row":5,"column":19},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":19},"end":{"row":5,"column":20},"action":"insert","lines":["("]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":20},"end":{"row":5,"column":21},"action":"insert","lines":[")"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":21},"end":{"row":5,"column":22},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":22},"end":{"row":5,"column":23},"action":"remove","lines":[" "]},{"start":{"row":5,"column":22},"end":{"row":6,"column":0},"action":"insert","lines":["",""]},{"start":{"row":6,"column":0},"end":{"row":6,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":2},"end":{"row":6,"column":3},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":3},"end":{"row":6,"column":4},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":4},"end":{"row":6,"column":5},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":5},"end":{"row":6,"column":6},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":6},"end":{"row":6,"column":7},"action":"insert","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":7},"end":{"row":6,"column":8},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":8},"end":{"row":6,"column":9},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":9},"end":{"row":7,"column":61},"action":"insert","lines":["'/xkcdify/:url(*)', function(req, res, next) {","      request(req.params.url, function(err, response, body) {"]}]}],[{"group":"doc","deltas":[{"start":{"row":6,"column":9},"end":{"row":6,"column":10},"action":"insert","lines":["("]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":1},"end":{"row":8,"column":2},"action":"insert","lines":["}"]},{"start":{"row":8,"column":0},"end":{"row":8,"column":1},"action":"remove","lines":[" "]},{"start":{"row":8,"column":0},"end":{"row":8,"column":6},"action":"insert","lines":["      "]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":7},"end":{"row":8,"column":8},"action":"remove","lines":[" "]},{"start":{"row":8,"column":7},"end":{"row":9,"column":0},"action":"insert","lines":["",""]},{"start":{"row":9,"column":0},"end":{"row":9,"column":6},"action":"insert","lines":["      "]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":6},"end":{"row":9,"column":7},"action":"insert","lines":["}"]},{"start":{"row":9,"column":0},"end":{"row":9,"column":6},"action":"remove","lines":["      "]},{"start":{"row":9,"column":0},"end":{"row":9,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":0},"end":{"row":7,"column":2},"action":"insert","lines":["  "]},{"start":{"row":8,"column":0},"end":{"row":8,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":0},"end":{"row":7,"column":2},"action":"remove","lines":["  "]},{"start":{"row":8,"column":0},"end":{"row":8,"column":2},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":0},"end":{"row":7,"column":2},"action":"remove","lines":["  "]},{"start":{"row":8,"column":0},"end":{"row":8,"column":2},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":7,"column":59},"end":{"row":8,"column":0},"action":"insert","lines":["",""]},{"start":{"row":8,"column":0},"end":{"row":8,"column":6},"action":"insert","lines":["      "]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":6},"end":{"row":10,"column":66},"action":"insert","lines":["        if (err) return next(err);","        if (response.headers['content-type']","          && response.headers['content-type'].slice(-4)=='html') {"]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":14},"end":{"row":8,"column":15},"action":"insert","lines":["\\"]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":14},"end":{"row":8,"column":15},"action":"remove","lines":["\\"]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":12},"end":{"row":8,"column":14},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":10},"end":{"row":8,"column":12},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":8},"end":{"row":8,"column":10},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":8,"column":6},"end":{"row":8,"column":8},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":6},"end":{"row":9,"column":8},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":8},"end":{"row":10,"column":10},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":10,"column":64},"end":{"row":11,"column":0},"action":"insert","lines":["",""]},{"start":{"row":11,"column":0},"end":{"row":11,"column":10},"action":"insert","lines":["          "]}]}],[{"group":"doc","deltas":[{"start":{"row":11,"column":10},"end":{"row":13,"column":38},"action":"insert","lines":["res.set(response.headers)","            .status(response.statusCode)","            .send(xkcdify.html(body));"]}]}],[{"group":"doc","deltas":[{"start":{"row":13,"column":38},"end":{"row":14,"column":0},"action":"insert","lines":["",""]},{"start":{"row":14,"column":0},"end":{"row":14,"column":12},"action":"insert","lines":["            "]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":12},"end":{"row":14,"column":13},"action":"insert","lines":["}"]},{"start":{"row":14,"column":0},"end":{"row":14,"column":12},"action":"remove","lines":["            "]},{"start":{"row":14,"column":0},"end":{"row":14,"column":8},"action":"insert","lines":["        "]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":9},"end":{"row":18,"column":9},"action":"insert","lines":[" else {","          res.set(response.headers)","            .status(response.statusCode)","            .send(response.statusCode, body);","        }"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":5},"end":{"row":19,"column":6},"action":"insert","lines":[")"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":3},"end":{"row":20,"column":4},"action":"insert","lines":[")"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":4},"end":{"row":20,"column":5},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":19,"column":6},"end":{"row":19,"column":7},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":21,"column":1},"end":{"row":21,"column":2},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":5},"end":{"row":21,"column":0},"action":"insert","lines":["",""]},{"start":{"row":21,"column":0},"end":{"row":21,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":21,"column":2},"end":{"row":43,"column":15},"action":"insert","lines":["    // To write a proper hijacking proxy that doesn't keep the original host","    // info inside the hostname, you need to do deep rewriting on all hrefs,","    // and all URLs inside CSS (and a shim to hijack XHR etc).","    // This is mondo hacky, and it doesn't work for things like assets","    // referenced in CSS (although it should?), but it works well enough for a","    // demo.","    // TODO: Some kind of middleware that can do this based on the route","    // (automatically listen to referers and redirect anything referred from","    // the above route)","    app.get('/*', function(req, res, next) {","      var ref = req.get('referer');","      ref = ref && urlLib.parse(ref);","      if (ref && (!ref.host || ref.host == req.hostname)) {","        //this is the part that would come from parsing the route","        var endOfFirstLevel = ref.path.indexOf('/',1)+1;","        var refOrigUrl = ref.path.substring(endOfFirstLevel);","        var newUrl = urlLib.resolve(refOrigUrl, req.url);","        res.redirect(ref.path.substring(0,endOfFirstLevel) + newUrl);","      }","      else res.status(404).send();","    });","","    return app;"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":0},"end":{"row":4,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":0},"end":{"row":3,"column":1},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":1},"end":{"row":3,"column":2},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":2},"end":{"row":3,"column":3},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":3},"end":{"row":3,"column":4},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":4},"end":{"row":3,"column":5},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":5},"end":{"row":3,"column":6},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":6},"end":{"row":3,"column":7},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":7},"end":{"row":3,"column":8},"action":"insert","lines":["L"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":8},"end":{"row":3,"column":9},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":9},"end":{"row":3,"column":10},"action":"insert","lines":["b"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":10},"end":{"row":3,"column":11},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":11},"end":{"row":3,"column":12},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":12},"end":{"row":3,"column":13},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":13},"end":{"row":3,"column":14},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":14},"end":{"row":3,"column":15},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":15},"end":{"row":3,"column":16},"action":"insert","lines":["q"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":16},"end":{"row":3,"column":17},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":17},"end":{"row":3,"column":18},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":18},"end":{"row":3,"column":19},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":19},"end":{"row":3,"column":20},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":20},"end":{"row":3,"column":21},"action":"insert","lines":["("]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":21},"end":{"row":3,"column":22},"action":"insert","lines":["'"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":22},"end":{"row":3,"column":23},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":23},"end":{"row":3,"column":24},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":24},"end":{"row":3,"column":25},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":25},"end":{"row":3,"column":26},"action":"insert","lines":["'"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":26},"end":{"row":3,"column":27},"action":"insert","lines":[")"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":27},"end":{"row":3,"column":28},"action":"insert","lines":["'"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":27},"end":{"row":3,"column":28},"action":"remove","lines":["'"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":27},"end":{"row":3,"column":28},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":46,"column":0},"action":"remove","lines":["var express = require(\"express\");","var xkcdify = require(\"xkcdify\");","var request = require(\"request\");","var urlLib = require('url');","","module.exports = function(cfg) {","  var app = express();","  app.get('/xkcdify/:url(*)', function(req, res, next) {","    request(req.params.url, function(err, response, body) {","      if (err) return next(err);","      if (response.headers['content-type']","        && response.headers['content-type'].slice(-4)=='html') {","          res.set(response.headers)","            .status(response.statusCode)","            .send(xkcdify.html(body));","        } else {","          res.set(response.headers)","            .status(response.statusCode)","            .send(response.statusCode, body);","        }","    });","  });","      // To write a proper hijacking proxy that doesn't keep the original host","    // info inside the hostname, you need to do deep rewriting on all hrefs,","    // and all URLs inside CSS (and a shim to hijack XHR etc).","    // This is mondo hacky, and it doesn't work for things like assets","    // referenced in CSS (although it should?), but it works well enough for a","    // demo.","    // TODO: Some kind of middleware that can do this based on the route","    // (automatically listen to referers and redirect anything referred from","    // the above route)","    app.get('/*', function(req, res, next) {","      var ref = req.get('referer');","      ref = ref && urlLib.parse(ref);","      if (ref && (!ref.host || ref.host == req.hostname)) {","        //this is the part that would come from parsing the route","        var endOfFirstLevel = ref.path.indexOf('/',1)+1;","        var refOrigUrl = ref.path.substring(endOfFirstLevel);","        var newUrl = urlLib.resolve(refOrigUrl, req.url);","        res.redirect(ref.path.substring(0,endOfFirstLevel) + newUrl);","      }","      else res.status(404).send();","    });","","    return app;","};",""]},{"start":{"row":0,"column":0},"end":{"row":46,"column":2},"action":"insert","lines":["var express = require(\"express\");","var request = require(\"request\");","var xkcdify = require(\"xkcdify\");","var urlLib = require(\"url\");","","module.exports = function appctor(cfg) {","    var app = express();","    app.get('/xkcdify/:url(*)', function(req, res, next) {","      request(req.params.url, function(err, response, body) {","        if (err) return next(err);","        if (response.headers['content-type']","          && response.headers['content-type'].slice(-4)=='html') {","          res.set(response.headers)","            .status(response.statusCode)","            .send(xkcdify.html(body));","        } else {","          res.set(response.headers)","            .status(response.statusCode)","            .send(response.statusCode, body);","        }","      });","    });","","    // To write a proper hijacking proxy that doesn't keep the original host","    // info inside the hostname, you need to do deep rewriting on all hrefs,","    // and all URLs inside CSS (and a shim to hijack XHR etc).","    // This is mondo hacky, and it doesn't work for things like assets","    // referenced in CSS (although it should?), but it works well enough for a","    // demo.","    // TODO: Some kind of middleware that can do this based on the route","    // (automatically listen to referers and redirect anything referred from","    // the above route)","    app.get('/*', function(req, res, next) {","      var ref = req.get('referer');","      ref = ref && urlLib.parse(ref);","      if (ref && (!ref.host || ref.host == req.hostname)) {","        //this is the part that would come from parsing the route","        var endOfFirstLevel = ref.path.indexOf('/',1)+1;","        var refOrigUrl = ref.path.substring(endOfFirstLevel);","        var newUrl = urlLib.resolve(refOrigUrl, req.url);","        res.redirect(ref.path.substring(0,endOfFirstLevel) + newUrl);","      }","      else res.status(404).send();","    });","","    return app;","};"]}]}]]},"ace":{"folds":[],"scrolltop":985,"scrollleft":0,"selection":{"start":{"row":46,"column":2},"end":{"row":46,"column":2},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":29,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1418353795413,"hash":"21788c7a2cbce849e36ce34be15751f5411b775b"}